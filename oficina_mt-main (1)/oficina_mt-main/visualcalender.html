<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda</title>
    <link rel="stylesheet" href="visualcalender.css">
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <img src="imagens/ccm.png" alt="Club Militar" />
        </div>
        
        <div class="logo-container center-logo">
            <img src="imagens/an_motos.png" alt="RN Motos" />
        </div>
        
        <div class="logo-container">
            <img src="imagens/agavi.png" alt="Agave" />
        </div>
    </header>

    <div class="container">
        <h1 class="page-title">Visualizar Agenda</h1>
        
        <div class="controls-panel">
            <div class="year-navigation">
                <button class="nav-btn" onclick="changeYear(-1)" title="Ano anterior">
                    ‚Üê
                </button>
                <div class="current-year" id="currentYear">2025</div>
                <button class="nav-btn" onclick="changeYear(1)" title="Pr√≥ximo ano">
                    ‚Üí
                </button>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-indicator legend-today"></div>
                    <span>Hoje</span>
                </div>
                <div class="legend-item">
                    <div class="legend-indicator legend-appointment"></div>
                    <span>Com agendamento</span>
                </div>
                <div class="legend-item">
                    <div class="legend-indicator legend-weekend"></div>
                    <span>Final de semana</span>
                </div>
                <div class="legend-item">
                    <div class="legend-indicator legend-maintenance"></div>
                    <span>Manuten√ß√£o</span>
                </div>
            </div>
        </div>
        
        <div class="calendar-grid" id="calendarGrid">
            <!-- Calendar will be generated by JavaScript -->
        </div>
    </div>

    <a href="agenda.html" class="back-button">
        ‚Üê Voltar para Agendamento
    </a>

    <!-- Modal for appointments -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Agendamentos</div>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Appointment content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            months: [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril',
                'Maio', 'Junho', 'Julho', 'Agosto',
                'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ],
            daysOfWeek: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'],
            refreshInterval: 30000 // 30 seconds
        };

        // State
        let currentYear = new Date().getFullYear();
        let appointments = [];

        // Utility Functions
        const formatDate = (dateString) => {
            return new Date(dateString).toLocaleDateString('pt-BR');
        };

        const formatDateTime = (dateString) => {
            return new Date(dateString).toLocaleString('pt-BR');
        };

        const isDateInRange = (date, startDate, endDate) => {
            const checkDate = new Date(date);
            const start = new Date(startDate);
            const end = new Date(endDate);
            return checkDate >= start && checkDate <= end;
        };

        const getDaysInMonth = (month, year) => {
            return new Date(year, month + 1, 0).getDate();
        };

        const getFirstDayOfMonth = (month, year) => {
            return new Date(year, month, 1).getDay();
        };

        // Data Management
        function loadAppointments() {
            // Load from global storage or create sample data
            if (!window.agendamentosGlobais || window.agendamentosGlobais.length === 0) {
                window.agendamentosGlobais = [
                    {
                        id: 'APT001',
                        nomeCliente: 'Jo√£o Silva',
                        modeloMoto: 'Honda CB 600F Hornet',
                        placaMoto: 'ABC-1234',
                        dataEntrada: '2025-06-02',
                        dataSaida: '2025-06-04',
                        observacoes: 'Revis√£o completa dos 10.000km, troca de √≥leo e filtros',
                        tipoServico: 'Revis√£o',
                        valor: 450.00
                    },
                    {
                        id: 'APT002',
                        nomeCliente: 'Maria Santos',
                        modeloMoto: 'Yamaha YZF-R3',
                        placaMoto: 'XYZ-5678',
                        dataEntrada: '2025-06-10',
                        dataSaida: '2025-06-12',
                        observacoes: 'Reparo do sistema de freios - pastilhas e disco dianteiro',
                        tipoServico: 'Reparo',
                        valor: 280.00
                    },
                    {
                        id: 'APT003',
                        nomeCliente: 'Carlos Pereira',
                        modeloMoto: 'Kawasaki Ninja 300',
                        placaMoto: 'KAW-9012',
                        dataEntrada: '2025-06-15',
                        dataSaida: '2025-06-17',
                        observacoes: 'Instala√ß√£o de escape esportivo e regulagem do carburador',
                        tipoServico: 'Customiza√ß√£o',
                        valor: 620.00
                    },
                    {
                        id: 'APT004',
                        nomeCliente: 'Ana Costa',
                        modeloMoto: 'Honda PCX 150',
                        placaMoto: 'PCX-3456',
                        dataEntrada: '2025-06-20',
                        dataSaida: '2025-06-21',
                        observacoes: 'Troca da correia CVT e limpeza do variador',
                        tipoServico: 'Manuten√ß√£o',
                        valor: 180.00
                    }
                ];
            }
            appointments = window.agendamentosGlobais || [];
        }

        function getAppointmentsForDate(date) {
            const dateString = date.toISOString().split('T')[0];
            return appointments.filter(appointment => 
                isDateInRange(dateString, appointment.dataEntrada, appointment.dataSaida)
            );
        }

        // Calendar Generation
        function createCalendar() {
            loadAppointments();
            
            const calendarGrid = document.getElementById('calendarGrid');
            const currentDate = new Date();
            const today = {
                year: currentDate.getFullYear(),
                month: currentDate.getMonth(),
                day: currentDate.getDate()
            };

            // Update year display
            document.getElementById('currentYear').textContent = currentYear;
            
            // Clear existing calendar
            calendarGrid.innerHTML = '';

            // Generate calendar for each month
            for (let month = 0; month < 12; month++) {
                const monthCard = createMonthCard(month, today);
                calendarGrid.appendChild(monthCard);
            }
        }

        function createMonthCard(month, today) {
            const monthCard = document.createElement('div');
            monthCard.className = 'month-card';

            // Month header
            const monthHeader = document.createElement('div');
            monthHeader.className = 'month-header';
            monthHeader.textContent = CONFIG.months[month];
            monthCard.appendChild(monthHeader);

            // Days container
            const daysContainer = document.createElement('div');
            daysContainer.className = 'days-container';

            // Days header
            const daysHeader = document.createElement('div');
            daysHeader.className = 'days-header';
            CONFIG.daysOfWeek.forEach(day => {
                const dayLabel = document.createElement('div');
                dayLabel.className = 'day-label';
                dayLabel.textContent = day;
                daysHeader.appendChild(dayLabel);
            });
            daysContainer.appendChild(daysHeader);

            // Days grid
            const daysGrid = document.createElement('div');
            daysGrid.className = 'days-grid';

            const daysInMonth = getDaysInMonth(month, currentYear);
            const firstDay = getFirstDayOfMonth(month, currentYear);

            // Previous month days
            const prevMonth = month === 0 ? 11 : month - 1;
            const prevYear = month === 0 ? currentYear - 1 : currentYear;
            const daysInPrevMonth = getDaysInMonth(prevMonth, prevYear);

            for (let i = firstDay - 1; i >= 0; i--) {
                const dayCell = createDayCell(daysInPrevMonth - i, true);
                daysGrid.appendChild(dayCell);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = createDayCell(day, false, month, today);
                daysGrid.appendChild(dayCell);
            }

            // Next month days to fill grid
            const totalCells = daysGrid.children.length;
            const remainingCells = Math.ceil(totalCells / 7) * 7 - totalCells;

            for (let day = 1; day <= remainingCells; day++) {
                const dayCell = createDayCell(day, true);
                daysGrid.appendChild(dayCell);
            }

            daysContainer.appendChild(daysGrid);
            monthCard.appendChild(daysContainer);

            return monthCard;
        }

        function createDayCell(day, isOtherMonth, month = 0, today = {}) {
            const dayCell = document.createElement('div');
            dayCell.className = 'day-cell';
            dayCell.textContent = day;

            if (isOtherMonth) {
                dayCell.classList.add('other-month');
                return dayCell;
            }

            const dayOfWeek = (getFirstDayOfMonth(month, currentYear) + day - 1) % 7;
            
            // Weekend styling
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                dayCell.classList.add('weekend');
            }

            // Today styling
            if (currentYear === today.year && month === today.month && day === today.day) {
                dayCell.classList.add('today');
            }

            // Check for appointments
            const dayDate = new Date(currentYear, month, day);
            const dayAppointments = getAppointmentsForDate(dayDate);

            if (dayAppointments.length > 0) {
                dayCell.classList.add('has-appointment');
                
                // Add appointment indicator
                const appointmentCount = document.createElement('div');
                appointmentCount.className = 'appointment-count';
                appointmentCount.textContent = dayAppointments.length;
                dayCell.appendChild(appointmentCount);
            }

            // Click handler
            dayCell.addEventListener('click', () => {
                showAppointments(dayDate, dayAppointments);
            });

            return dayCell;
        }

        // Modal Functions
        function showAppointments(date, appointmentList) {
            const modal = document.getElementById('appointmentModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            const dateString = date.toLocaleDateString('pt-BR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            modalTitle.innerHTML = `üìÖ ${dateString}`;

            if (appointmentList.length === 0) {
                modalBody.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <h3>Nenhum agendamento</h3>
                        <p>N√£o h√° agendamentos para esta data.</p>
                    </div>
                `;
            } else {
                modalBody.innerHTML = appointmentList.map(appointment => `
                    <div class="appointment-card">
                        <div class="appointment-header">
                            <div class="client-name">${appointment.nomeCliente}</div>
                            <div class="appointment-id">#${appointment.id}</div>
                        </div>
                        <div class="motorcycle-info">
                            üèçÔ∏è ${appointment.modeloMoto} - ${appointment.placaMoto}
                        </div>
                        <div class="appointment-details">
                            <div class="detail-item">
                                <span class="detail-label">üìÖ Entrada:</span>
                                <span class="detail-value">${formatDate(appointment.dataEntrada)}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üì§ Sa√≠da:</span>
                                <span class="detail-value">${formatDate(appointment.dataSaida)}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üîß Servi√ßo:</span>
                                <span class="detail-value">${appointment.tipoServico || 'N√£o especificado'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üí∞ Valor:</span>
                                <span class="detail-value">R$ ${appointment.valor ? appointment.valor.toFixed(2) : '0,00'}</span>
                            </div>
                        </div>
                        <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #e2e8f0;">
                            <strong>Observa√ß√µes:</strong> ${appointment.observacoes || 'Nenhuma observa√ß√£o'}
                        </div>
                    </div>
                `).join('');
            }

            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('appointmentModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Navigation Functions
        function changeYear(direction) {
            currentYear += direction;
            createCalendar();
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            createCalendar();
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('appointmentModal');
            if (e.target === modal) {
                closeModal();
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Auto-refresh appointments
        setInterval(() => {
            const oldLength = appointments.length;
            loadAppointments();
            if (appointments.length !== oldLength) {
                createCalendar();
            }
        }, CONFIG.refreshInterval);

        // Initialize
        createCalendar();
    </script>
</body>
</html>